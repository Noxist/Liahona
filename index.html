<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- App Identität -->
    <title>Liahona</title>
    <meta name="apple-mobile-web-app-title" content="Liahona">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <!-- Das Icon (Direkt als SVG eingebettet für Home-Bildschirm) -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='48' fill='%23020617'/><circle cx='50' cy='50' r='35' fill='none' stroke='%23D4AF37' stroke-width='2'/><path d='M50 25 L55 50 L50 75 L45 50 Z' fill='%23D4AF37'/><path d='M25 50 L50 45 L75 50 L50 55 Z' fill='%23D4AF37' opacity='0.6'/><circle cx='50' cy='50' r='4' fill='%23F3E5AB'/></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23020617'/><circle cx='50' cy='50' r='35' fill='none' stroke='%23D4AF37' stroke-width='3'/><path d='M50 20 L58 50 L50 80 L42 50 Z' fill='%23D4AF37'/><circle cx='50' cy='50' r='5' fill='%23F3E5AB'/></svg>">

    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkxpYWhvbmEiLAogICJzaG9ydF9uYW1lIjogIkxpYWhvbmEiLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzAyMDYxNyIsCiAgInRoZW1lX2NvbG9yIjogIiMwMjA2MTciCn0=">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&family=Inter:wght@300;400;600&display=swap');

        :root {
            /* Light Mode (Pergament) */
            --bg-color: #FDFBF7;
            --text-main: #1C1917;
            --text-dim: #78716C;
            --gold-primary: #B45309;
            --orb-bg: rgba(255, 255, 255, 0.75);
            --orb-border: rgba(180, 83, 9, 0.4);
            --ring-color: rgba(180, 83, 9, 0.15);
            --overlay-bg: rgba(253, 251, 247, 0.98);
            --particle-color: 180, 83, 9;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                /* Dark Mode (Celestial) */
                --bg-color: #020617;
                --text-main: #F3F4F6;
                --text-dim: #94A3B8;
                --gold-primary: #D4AF37;
                --orb-bg: rgba(30, 41, 59, 0.5);
                --orb-border: rgba(212, 175, 55, 0.3);
                --ring-color: rgba(212, 175, 55, 0.15);
                --overlay-bg: rgba(2, 6, 23, 0.98);
                --particle-color: 212, 175, 55;
            }
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            height: 100vh;
            margin: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: env(safe-area-inset-top) 20px env(safe-area-inset-bottom) 20px;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
            transition: background-color 0.5s ease;
        }

        #particle-canvas { position: fixed; inset: 0; z-index: 0; pointer-events: none; }

        .header-title {
            font-family: 'Cinzel', serif;
            letter-spacing: 0.3em;
            color: var(--gold-primary);
            font-size: 1.25rem;
            font-weight: 700;
            text-transform: uppercase;
            margin-top: 30px;
            z-index: 10;
        }

        .liahona-wrapper {
            position: relative;
            width: 300px;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 20;
        }

        .outer-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 1px solid var(--ring-color);
        }

        .orb-core {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: var(--orb-bg);
            border: 1px solid var(--orb-border);
            backdrop-filter: blur(15px);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 40px rgba(0,0,0,0.1), inset 0 0 25px var(--ring-color);
            transition: transform 0.1s cubic-bezier(0.1, 0.5, 0.5, 1);
            will-change: transform;
            cursor: pointer;
        }

        .active-state .orb-core {
            border-color: var(--gold-primary);
            box-shadow: 0 0 60px var(--gold-primary);
        }

        .result-overlay {
            position: absolute;
            inset: 0;
            background: var(--overlay-bg);
            backdrop-filter: blur(25px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.6s ease;
            z-index: 100;
        }

        .result-overlay.show { opacity: 1; pointer-events: auto; }

        .book-display {
            font-family: 'Cinzel', serif;
            font-size: 2.2rem;
            color: var(--text-main);
            text-align: center;
            font-weight: 700;
            line-height: 1.2;
        }

        .ref-display {
            font-size: 1.6rem;
            color: var(--gold-primary);
            letter-spacing: 0.1em;
            margin-top: 0.8rem;
            margin-bottom: 40px;
        }

        .btn-gold {
            border: 1px solid var(--gold-primary);
            color: var(--gold-primary);
            padding: 16px 48px;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            font-size: 0.9rem;
            font-weight: 600;
            background: transparent;
            transition: all 0.3s;
            border-radius: 4px;
        }

        .btn-gold:active { background: var(--gold-primary); color: var(--bg-color); }
    </style>
</head>
<body>

    <canvas id="particle-canvas"></canvas>

    <div class="header-title">Liahona</div>

    <div class="liahona-wrapper">
        <div class="outer-ring"></div>
        <div id="orb" class="orb-core">
            <i class="fas fa-fingerprint text-4xl opacity-30" id="icon" style="color: var(--gold-primary);"></i>
        </div>
    </div>

    <div class="text-[10px] tracking-[0.4em] uppercase opacity-50 mb-10" id="status-text" style="color: var(--text-main); font-weight: 600;">Fokussieren</div>

    <div id="result-overlay" class="result-overlay">
        <div id="r-book" class="book-display"></div>
        <div id="r-ref" class="ref-display"></div>
        <button id="btn-open" class="btn-gold">Lesen</button>
        <div id="btn-reset" class="mt-12 text-[10px] uppercase tracking-[0.3em] cursor-pointer" style="color: var(--text-dim);">Neu ausrichten</div>
    </div>

    <script>
        // Datenbank mit exakten Verszahlen aller Kapitel des Buches Mormon
        const DB = [
            { n: "1. Nephi", s: "1-ne", v: [20, 24, 31, 38, 22, 6, 22, 38, 6, 22, 36, 23, 42, 30, 36, 39, 55, 25, 24, 22, 26, 31] },
            { n: "2. Nephi", s: "2-ne", v: [32, 30, 25, 35, 34, 18, 9, 25, 54, 25, 8, 18, 32, 12, 30, 9, 25, 20, 20, 30, 37, 29, 31, 15, 30, 33, 35, 32, 14, 18, 21, 9, 15] },
            { n: "Jakob", s: "jacob", v: [19, 35, 14, 18, 77, 13, 27] },
            { n: "Enos", s: "enos", v: [27] },
            { n: "Jarom", s: "jarom", v: [15] },
            { n: "Omni", s: "omni", v: [30] },
            { n: "Worte Mormons", s: "w-of-m", v: [18] },
            { n: "Mosia", s: "mosiah", v: [18, 41, 27, 30, 15, 7, 33, 21, 19, 22, 29, 37, 35, 12, 31, 15, 20, 35, 29, 26, 36, 16, 39, 25, 24, 39, 37, 20, 47] },
            { n: "Alma", s: "alma", v: [33, 38, 27, 20, 62, 8, 27, 32, 34, 32, 46, 37, 31, 29, 19, 21, 39, 43, 36, 30, 23, 35, 18, 30, 17, 37, 30, 14, 17, 60, 38, 43, 23, 41, 16, 30, 47, 15, 19, 26, 15, 31, 54, 24, 24, 41, 36, 25, 30, 40, 37, 40, 23, 58, 35, 57, 36, 41, 13, 36, 21, 52, 17] },
            { n: "Helaman", s: "hel", v: [34, 14, 37, 26, 52, 41, 29, 28, 41, 19, 38, 26, 39, 31, 17, 25] },
            { n: "3. Nephi", s: "3-ne", v: [30, 19, 26, 33, 26, 30, 26, 25, 22, 19, 41, 48, 34, 27, 24, 20, 25, 39, 36, 46, 29, 17, 14, 3, 6, 21, 33, 40, 9, 2] },
            { n: "4. Nephi", s: "4-ne", v: [49] },
            { n: "Mormon", s: "morm", v: [19, 29, 22, 23, 24, 22, 10, 41, 37] },
            { n: "Ether", s: "eth", v: [43, 25, 28, 19, 6, 30, 27, 26, 35, 34, 23, 41, 31, 31, 34] },
            { n: "Moroni", s: "moro", v: [4, 3, 4, 3, 2, 9, 48, 30, 26, 34] }
        ];

        // Partikel System mit verbesserten Effekten
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        let w, h, particles = [];
        let isHolding = false;
        let moveIntens = 0;

        function init() {
            w = canvas.width = window.innerWidth;
            h = canvas.height = window.innerHeight;
            particles = [];
            // Mehr Partikel (200 statt 100) für bessere Optik
            for(let i = 0; i < 200; i++) {
                particles.push({
                    x: Math.random() * w, 
                    y: Math.random() * h,
                    s: Math.random() * 2.5 + 0.5, // Unterschiedliche Grössen
                    v: Math.random() * 0.4 + 0.1,
                    alpha: Math.random() * 0.5 + 0.2
                });
            }
        }

        function draw() {
            ctx.clearRect(0, 0, w, h);
            const cx = w/2, cy = h/2;
            const pCol = getComputedStyle(document.documentElement).getPropertyValue('--particle-color');
            
            particles.forEach(p => {
                if(isHolding) {
                    const dx = cx - p.x, dy = cy - p.y;
                    const d = Math.sqrt(dx*dx + dy*dy);
                    // Vortex Sog Effekt
                    const speed = (10 + (moveIntens * 0.1)) * (400 / (d + 100));
                    p.x += dx/d * speed; p.y += dy/d * speed;
                    
                    // Reset wenn im Zentrum
                    if(d < 20) { 
                        const angle = Math.random() * Math.PI * 2;
                        p.x = cx + Math.cos(angle) * (w > h ? w : h);
                        p.y = cy + Math.sin(angle) * (w > h ? w : h);
                    }
                } else {
                    // Normales Schweben
                    p.y -= p.v; 
                    if(p.y < 0) p.y = h;
                }
                ctx.fillStyle = `rgba(${pCol}, ${p.alpha})`;
                ctx.beginPath(); ctx.arc(p.x, p.y, p.s, 0, Math.PI*2); ctx.fill();
            });
            moveIntens *= 0.95;
            requestAnimationFrame(draw);
        }

        window.addEventListener('resize', init);
        init(); draw();

        const orb = document.getElementById('orb');
        const overlay = document.getElementById('result-overlay');
        const status = document.getElementById('status-text');
        
        let start = 0, distTotal = 0, last = {x:0, y:0}, selection = null;

        const onDown = (e) => {
            if(overlay.classList.contains('show')) return;
            isHolding = true; start = Date.now(); distTotal = 0;
            const p = e.touches ? e.touches[0] : e;
            last = {x: p.clientX, y: p.clientY};
            document.body.classList.add('active-state');
            status.innerText = "Empfange...";
            if(navigator.vibrate) navigator.vibrate(15);
        };

        const onMove = (e) => {
            if(!isHolding) return;
            const p = e.touches ? e.touches[0] : e;
            const dX = p.clientX - last.x, dY = p.clientY - last.y;
            const moveDist = Math.sqrt(dX*dX + dY*dY);
            distTotal += moveDist;
            moveIntens = Math.min(moveDist * 2, 80);
            
            // Flüssige Orb Bewegung (Faktor 1.0 für direkte Steuerung)
            const f = 1.0, m = 60;
            const oX = (p.clientX - w/2)*f, oY = (p.clientY - h/2)*f;
            const r = Math.sqrt(oX*oX + oY*oY);
            orb.style.transform = `translate(${r > m ? oX/r*m : oX}px, ${r > m ? oY/r*m : oY}px)`;
            last = {x: p.clientX, y: p.clientY};
        };

        const onUp = () => {
            if(!isHolding) return;
            const dur = Date.now() - start; isHolding = false;
            document.body.classList.remove('active-state');
            orb.style.transform = "translate(0,0)";
            
            if(dur < 600) { 
                status.innerText = "Länger fokussieren"; 
                setTimeout(() => { if(!isHolding) status.innerText = "Fokussieren"; }, 2000);
                return; 
            }
            
            // Seed-Berechnung aus Zeit, Bewegung und aktueller Millisekunde
            const seed = Math.floor(dur + distTotal + Date.now());
            const b = DB[seed % DB.length];
            const cI = (seed * 17) % b.v.length;
            const vLimit = b.v[cI];
            const v = (Math.floor(seed / 7) % vLimit) + 1;
            selection = {b, c: cI+1, v};
            
            document.getElementById('r-book').innerText = b.n;
            document.getElementById('r-ref').innerText = `${selection.c}:${v}`;
            
            setTimeout(() => {
                overlay.classList.add('show');
                if(navigator.vibrate) navigator.vibrate([30, 60, 30]);
            }, 500);
        };

        orb.addEventListener('pointerdown', onDown);
        window.addEventListener('pointermove', onMove);
        window.addEventListener('pointerup', onUp);
        window.addEventListener('pointercancel', onUp);

        document.getElementById('btn-reset').addEventListener('click', () => {
            overlay.classList.remove('show'); status.innerText = "Fokussieren";
        });

        document.getElementById('btn-open').addEventListener('click', () => {
            if(!selection) return;
            const s = selection;
            // Gospel Library Link mit Vers-Unterstützung
            const app = `gospellibrary://content/scriptures/bofm/${s.b.s}/${s.c}?verse=${s.v}#p${s.v}`;
            const web = `https://www.churchofjesuschrist.org/study/scriptures/bofm/${s.b.s}/${s.c}.${s.v}?lang=deu#p${s.v}`;
            const t = Date.now(); 
            window.location.href = app;
            setTimeout(() => { if(Date.now() - t < 2000) window.open(web, '_blank'); }, 1000);
        });
    </script>
</body>
</html>

